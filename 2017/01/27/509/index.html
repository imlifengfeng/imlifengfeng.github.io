<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>iOS NSNotification详解 | 李峰峰博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">iOS NSNotification详解</h1><a id="logo" href="/.">李峰峰博客</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">iOS NSNotification详解</h1><div class="post-meta">Jan 27, 2017<span> | </span><span class="category"><a href="/categories/iOS/">iOS</a></span></div><div class="post-content"><p>一、<strong>概述</strong></p>
<p>NSNotification顾名思义就是通知的作用，一个对象通知另外一个对象，可以用来传递参数、通信等作用，与delegate的一对一不同，通知是多对多的。在一个对象中注册了通知，那么其他任意对象都可以来对这个对象发出通知。</p>
<p>二、<strong>NSNotificationCenter</strong></p>
<p>每一个应用程序都有一个通知中心(NSNotificationCenter)实例，专门负责协助不同对象之间的消息通信</p>
<p>任何一个对象都可以向通知中心发布通知(NSNotification)，描述自己在做什么。其他感兴趣的对象(Observer)可以申请在某个特定通知发布时(或在某个特定的对象发布通知时)收到这个通知</p>
<p>通知与代理的区别：通知是多对多的，代理是一对一的。如下图：</p>
<p><img src="/images/2017/01/图片-1.png" alt="图片 1"></p>
<p>比如，键盘弹出的时候也会发送一条通知。</p>
<p>三、<strong>NSNotification</strong></p>
<p>一个完整的通知一般包含3个属性：</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby"> (NSString *)name; <span class="regexp">//</span> 通知的名称</span></span><br><span class="line"><span class="ruby">- (id)object; <span class="regexp">//</span> 通知发布者(是谁要发布通知)</span></span><br><span class="line"><span class="ruby">- (NSDictionary *)userInfo; <span class="regexp">//</span> 一些额外的信息(通知发布者传递给通知接收者的信息内容)</span></span><br></pre></td></tr></table></figure>
<p>创建一个通知（NSNotification）对象：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (instance<span class="keyword">type</span>)notificationWithName:(<span class="type">NSString</span> *)aName object:(id)anObject;</span><br></pre></td></tr></table></figure>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (instance<span class="keyword">type</span>)notificationWithName:(<span class="type">NSString</span> *)aName object:(id)anObject userInfo:(<span class="type">NSDictionary</span> *)aUserInfo;</span><br></pre></td></tr></table></figure>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (instance<span class="keyword">type</span>)initWithName:(<span class="type">NSString</span> *)name object:(id)object userInfo:(<span class="type">NSDictionary</span> *)userInfo;</span><br></pre></td></tr></table></figure>
<p><strong>实际上创建通知对象并不是必须的，更方便的是通过通知中心发送通知。</strong></p>
<p>四、<strong>发布通知</strong></p>
<p>通知中心(NSNotificationCenter)提供了相应的方法来帮助发布通知。</p>
<p>获得通知中心对象：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSNotificationCenter</span> *center = [<span class="built_in">NSNotificationCenter</span> defaultCenter];</span><br></pre></td></tr></table></figure>
<p>通知中心提供的发布通知的方法：</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- <span class="params">(void)</span>postNotification:<span class="params">(NSNotification *)</span>notification;</span><br></pre></td></tr></table></figure>
<p>上述为发布一个notification通知，可在notification对象中设置通知的名称、通知发布者、额外信息等。</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- <span class="params">(void)</span>postNotificationName:<span class="params">(NSString *)</span>aName object:<span class="params">(id)</span>anObject;</span><br></pre></td></tr></table></figure>
<p>发布一个名称为aName的通知，anObject为这个通知的发布者。</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- <span class="params">(void)</span>postNotificationName:<span class="params">(NSString *)</span>aName object:<span class="params">(id)</span>anObject userInfo:<span class="params">(NSDictionary *)</span>aUserInfo;</span><br></pre></td></tr></table></figure>
<p>发布一个名称为aName的通知，anObject为这个通知的发布者，aUserInfo为额外信息。</p>
<p>当我们添加通知以后，我们就可以发出通知，也是通过NSNotificationCenter类的defaultCenter来获取到通知中心，然后通过postNotificationName来发出通知。这里需要注意的一点就是<strong>这样发出的通知是同步操作</strong>，也就是只有当发出的通知执行完毕以后才会继续执行接下去的代码：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)getNotification:(<span class="built_in">NSNotification</span> *)info&#123;</span><br><span class="line">    <span class="built_in">NSDictionary</span> *dict = info.userInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是发出通知以后会调用的方法，在多线程操作时，发出通知的对象和接收通知的对象需要处于同一个线程。</p>
<p>五、<strong>注册通知监听器</strong></p>
<p>通知中心(NSNotificationCenter)提供了方法来注册一个监听通知的监听器(Observer)。</p>
<p>方法1：</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- <span class="params">(void)</span>addObserver:<span class="params">(id)</span>observer selector:<span class="params">(SEL)</span>aSelector name:<span class="params">(NSString *)</span>aName object:<span class="params">(id)</span>anObject;</span><br></pre></td></tr></table></figure>
<p>observer：监听器，即谁要接收这个通知。</p>
<p>aSelector：收到通知后，回调监听器的这个方法，并且把通知对象当做参数传入，意思是收到通知后调用接收者中的哪个方法。</p>
<p>aName：通知的名称。如果为nil，那么无论通知的名称是什么，监听器都能收到这个通知，意思是监听哪个aName的通知。</p>
<p>anObject：通知发布者。如果为anObject和aName都为nil，监听器都收到所有的通知，意思是监听哪个对象发出的通知。</p>
<p>例如，监听输入框内容是否发生改变：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[[NSNotificationCenter defaultCenter]</span> <span class="selector-tag">addObserver</span><span class="selector-pseudo">:self</span> <span class="selector-tag">selector</span>:</span><br><span class="line">@<span class="keyword">selector</span>(<span class="keyword">textChange</span>) name:UITextFieldTextDidChangeNotification object:self.accountField];</span><br></pre></td></tr></table></figure>
<p>当输入框内容发生改变会自动发送通知，之后会调用我们自定义的textChange方法。</p>
<p>方法2：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">-</span> (id)<span class="selector-tag">addObserverForName</span><span class="selector-pseudo">:(NSString</span> *)<span class="selector-tag">name</span> <span class="selector-tag">object</span><span class="selector-pseudo">:(id)obj</span> <span class="selector-tag">queue</span>:</span><br><span class="line">(NSOperationQueue *)<span class="selector-tag">queue</span> <span class="selector-tag">usingBlock</span><span class="selector-pseudo">:(void</span> (^)(NSNotification *note))<span class="selector-tag">block</span>;</span><br></pre></td></tr></table></figure>
<p>name：通知的名称。</p>
<p>obj：通知发布者。</p>
<p>queue：决定了block在哪个操作队列中执行，如果传nil，默认在当前操作队列中同步执行。</p>
<p>block：收到对应的通知时，会回调这个block。</p>
<p>接下来我们通过一个小demo来看下具体用法（代码比较简单，不再解释，不过这个代码有小问题哦，还没有取消注册监听呢，取消方法后面再讲~）：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Person.h</span></span><br><span class="line"><span class="comment">//  NotificationTest</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 李峰峰 on 2017/1/27.</span></span><br><span class="line"><span class="comment">//  Copyright © 2017年 李峰峰. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>)<span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)newsCome:(<span class="built_in">NSNotification</span> *)note;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Person.m</span></span><br><span class="line"><span class="comment">//  NotificationTest</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 李峰峰 on 2017/1/27.</span></span><br><span class="line"><span class="comment">//  Copyright © 2017年 李峰峰. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"NewsCompany.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)newsCome:(<span class="built_in">NSNotification</span> *)note</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 通知的发布者</span></span><br><span class="line">    NewsCompany *obj = note.object;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@接收到了%@发出的通知,通知内容是:%@"</span>, <span class="keyword">self</span>.name, obj.name, note.userInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  NewsCompany.h</span></span><br><span class="line"><span class="comment">//  NotificationTest</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 李峰峰 on 2017/1/27.</span></span><br><span class="line"><span class="comment">//  Copyright © 2017年 李峰峰. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NewsCompany</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>)<span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  NewsCompany.m</span></span><br><span class="line"><span class="comment">//  NotificationTest</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 李峰峰 on 2017/1/27.</span></span><br><span class="line"><span class="comment">//  Copyright © 2017年 李峰峰. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"NewsCompany.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NewsCompany</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  main.m</span></span><br><span class="line"><span class="comment">//  NotificationTest</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 李峰峰 on 2017/1/27.</span></span><br><span class="line"><span class="comment">//  Copyright © 2017年 李峰峰. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">#<span class="keyword">import</span> &lt;UIKit/UIKit.h&gt;</span><br><span class="line">#<span class="keyword">import</span> <span class="string">"AppDelegate.h"</span></span><br><span class="line">#<span class="keyword">import</span> <span class="string">"Person.h"</span></span><br><span class="line">#<span class="keyword">import</span> <span class="string">"NewsCompany.h"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main(int argc, char * argv[]) &#123;</span><br><span class="line">    <span class="meta">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="comment">// 1.初始化机构</span></span><br><span class="line">        NewsCompany *tx = [[NewsCompany alloc] <span class="keyword">init</span>];</span><br><span class="line">        tx.name = @<span class="string">"腾讯新闻"</span>;</span><br><span class="line">        </span><br><span class="line">        NewsCompany *sina = [[NewsCompany alloc] <span class="keyword">init</span>];</span><br><span class="line">        sina.name = @<span class="string">"新浪新闻"</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2.初始化3个人</span></span><br><span class="line">        Person *zhangsan = [[Person alloc] <span class="keyword">init</span>];</span><br><span class="line">        zhangsan.name = @<span class="string">"张三"</span>;</span><br><span class="line">        </span><br><span class="line">        Person *lisi = [[Person alloc] <span class="keyword">init</span>];</span><br><span class="line">        lisi.name = @<span class="string">"李四"</span>;</span><br><span class="line">        </span><br><span class="line">        Person *wangwu = [[Person alloc] <span class="keyword">init</span>];</span><br><span class="line">        wangwu.name = @<span class="string">"王五"</span>;</span><br><span class="line">        </span><br><span class="line">        NSNotificationCenter *center = [NSNotificationCenter defaultCenter];</span><br><span class="line">        <span class="comment">// 3.添加监听器</span></span><br><span class="line">        <span class="comment">// zhangsan只监听tx发出的junshi_news_come通知</span></span><br><span class="line">        <span class="comment">// zhangsan</span></span><br><span class="line">        [center addObserver:zhangsan selector:<span class="meta">@selector(newsCome:)</span> name:@<span class="string">"junshi_news_come"</span> <span class="keyword">object</span>:nil];</span><br><span class="line">        [center addObserver:zhangsan selector:<span class="meta">@selector(newsCome:)</span> name:@<span class="string">"yule_news_come"</span> <span class="keyword">object</span>:nil];</span><br><span class="line">        <span class="comment">// lisi</span></span><br><span class="line">        [center addObserver:lisi selector:<span class="meta">@selector(newsCome:)</span> name:nil <span class="keyword">object</span>:tx];</span><br><span class="line">        <span class="comment">// wangwu</span></span><br><span class="line">        [center addObserver:wangwu selector:<span class="meta">@selector(newsCome:)</span> name:nil <span class="keyword">object</span>:nil];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4.发布新闻</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// tx发布了一则叫做junshi_news_come的通知</span></span><br><span class="line">        [center postNotificationName:@<span class="string">"junshi_news_come"</span></span><br><span class="line">                              <span class="keyword">object</span>:tx</span><br><span class="line">                            userInfo:@&#123;@<span class="string">"title"</span> : @<span class="string">"伊拉克战争停止了"</span>,</span><br><span class="line">                                       @<span class="string">"intro"</span> : @<span class="string">"伊拉克战争停止了.........."</span>&#125;];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// sina发布了一则叫做yule_news_come的通知</span></span><br><span class="line">        [center postNotificationName:@<span class="string">"yule_news_come"</span></span><br><span class="line">                              <span class="keyword">object</span>:sina</span><br><span class="line">                            userInfo:@&#123;@<span class="string">"title"</span> : @<span class="string">"川普出柜迎娶安倍"</span>,</span><br><span class="line">                                       @<span class="string">"intro"</span> : @<span class="string">"川普出柜迎娶安倍.........."</span>&#125;];</span><br><span class="line">   </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span>-01-27 <span class="number">15</span>:<span class="number">43</span>:<span class="number">29</span>.<span class="number">273</span> NotificationTest[<span class="number">2395</span>:<span class="number">155782</span>] 张三接收到了腾讯新闻发出的通知,通知内容是:&#123;</span><br><span class="line">    intro = <span class="string">"伊拉克战争停止了.........."</span><span class="comment">;</span></span><br><span class="line">    title = <span class="string">"伊拉克战争停止了"</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="number">2017</span>-01-27 <span class="number">15</span>:<span class="number">43</span>:<span class="number">29</span>.<span class="number">275</span> NotificationTest[<span class="number">2395</span>:<span class="number">155782</span>] 李四接收到了腾讯新闻发出的通知,通知内容是:&#123;</span><br><span class="line">    intro = <span class="string">"伊拉克战争停止了.........."</span><span class="comment">;</span></span><br><span class="line">    title = <span class="string">"伊拉克战争停止了"</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="number">2017</span>-01-27 <span class="number">15</span>:<span class="number">43</span>:<span class="number">29</span>.<span class="number">275</span> NotificationTest[<span class="number">2395</span>:<span class="number">155782</span>] 王五接收到了腾讯新闻发出的通知,通知内容是:&#123;</span><br><span class="line">    intro = <span class="string">"伊拉克战争停止了.........."</span><span class="comment">;</span></span><br><span class="line">    title = <span class="string">"伊拉克战争停止了"</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="number">2017</span>-01-27 <span class="number">15</span>:<span class="number">43</span>:<span class="number">29</span>.<span class="number">276</span> NotificationTest[<span class="number">2395</span>:<span class="number">155782</span>] 张三接收到了新浪新闻发出的通知,通知内容是:&#123;</span><br><span class="line">    intro = <span class="string">"川普出柜迎娶安倍.........."</span><span class="comment">;</span></span><br><span class="line">    title = <span class="string">"川普出柜迎娶安倍"</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="number">2017</span>-01-27 <span class="number">15</span>:<span class="number">43</span>:<span class="number">29</span>.<span class="number">277</span> NotificationTest[<span class="number">2395</span>:<span class="number">155782</span>] 王五接收到了新浪新闻发出的通知,通知内容是:&#123;</span><br><span class="line">    intro = <span class="string">"川普出柜迎娶安倍.........."</span><span class="comment">;</span></span><br><span class="line">    title = <span class="string">"川普出柜迎娶安倍"</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>六、<strong>取消注册通知监听器</strong></p>
<p>通知中心不会保留(retain)监听器对象，在通知中心注册过的对象，必须在该对象释放前取消注册。否则，当相应的通知再次出现时，通知中心仍然会向该监听器发送消息。因为相应的监听器对象已经被释放了，所以可能会导致应用崩溃。<strong>在上面我们的小demo中就没有取消注册监听器</strong>。</p>
<p>通知中心提供了相应的方法来取消注册监听器：</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- <span class="params">(void)</span>removeObserver:<span class="params">(id)</span>observer;</span><br></pre></td></tr></table></figure>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- <span class="params">(void)</span>removeObserver:<span class="params">(id)</span>observer name:<span class="params">(NSString *)</span>aName object:<span class="params">(id)</span>anObject;</span><br></pre></td></tr></table></figure>
<p>一般在监听器销毁之前取消注册（如在监听器中加入下列代码）：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">dealloc</span> &#123;</span><br><span class="line">	<span class="comment">//[super dealloc];  非ARC中需要调用此句</span></span><br><span class="line">    <span class="selector-attr">[[NSNotificationCenter defaultCenter]</span> <span class="selector-tag">removeObserver</span><span class="selector-pseudo">:self</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>七、<strong>NSNotificationQueue</strong></p>
<p>上面说到 <strong>NSNotificationCenter是一个同步操作，也就是只有当响应的通知的代码执行完毕以后，发出通知的对象的代码才会继续往下执行。而NSNotificationQueue则与之相反，其通知是异步发送的</strong>。</p>
<p>NSNotificationQueue：通知队列，用来管理多个通知的调用。通知队列通常以先进先出（FIFO）顺序维护通。NSNotificationQueue就像一个缓冲池把一个个通知放进池子中，使用特定方式通过NSNotificationCenter发送到相应的监听者。</p>
<p>创建通知队列方法:</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (instance<span class="keyword">type</span>)initWithNotificationCenter:(<span class="type">NSNotificationCenter</span> *)notificationCenter <span class="type">NS_DESIGNATED_INITIALIZER</span>;</span><br></pre></td></tr></table></figure>
<p>往队列加入通知（发送通知）方法:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)enqueueNotification:(<span class="built_in">NSNotification</span> *)notification postingStyle:(<span class="built_in">NSPostingStyle</span>)postingStyle;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)enqueueNotification:(<span class="built_in">NSNotification</span> *)notification postingStyle:(<span class="built_in">NSPostingStyle</span>)postingStyle coalesceMask:(<span class="built_in">NSNotificationCoalescing</span>)coalesceMask forModes:(<span class="keyword">nullable</span> <span class="built_in">NSArray</span>&lt;<span class="built_in">NSRunLoopMode</span>&gt; *)modes;</span><br></pre></td></tr></table></figure>
<p>移除队列中的通知方法:</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- <span class="params">(void)</span>dequeueNotificationsMatching:<span class="params">(NSNotification *)</span>notification coalesceMask:<span class="params">(NSUInteger)</span>coalesceMask;</span><br></pre></td></tr></table></figure>
<p>发送方式：</p>
<p><em>NSPostingStyle</em>包括三种类型：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typedef <span class="type">NS_ENUM</span>(<span class="type">NSUInteger</span>, <span class="type">NSPostingStyle</span>) &#123;</span><br><span class="line">    <span class="type">NSPostWhenIdle</span> = 1,</span><br><span class="line">    <span class="type">NSPostASAP</span> = 2,</span><br><span class="line">    <span class="type">NSPostNow</span> = 3  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><em>NSPostWhenIdle</em>：空闲发送通知，当运行循环处于等待或空闲状态时，发送通知，对于不重要的通知可以使用。<br><em>NSPostASAP</em>：尽快发送通知，当前运行循环迭代完成时，通知将会被发送，有点类似没有延迟的定时器。<br><em>NSPostNow</em> ：同步发送通知，如果不使用合并通知 和postNotification:一样是同步通知。</p>
<p>合并通知：</p>
<p><em>NSNotificationCoalescing</em>也包括三种类型：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typedef <span class="type">NS_OPTIONS</span>(<span class="type">NSUInteger</span>, <span class="type">NSNotificationCoalescing</span>) &#123;</span><br><span class="line">    <span class="type">NSNotificationNoCoalescing</span> = 0,</span><br><span class="line">    <span class="type">NSNotificationCoalescingOnName</span> = 1,</span><br><span class="line">    <span class="type">NSNotificationCoalescingOnSender</span> = 2</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><em>NSNotificationNoCoalescing</em>：不合并通知。<br><em>NSNotificationCoalescingOnName</em>：合并相同名称的通知。<br><em>NSNotificationCoalescingOnSender</em>：合并相同通知和同一对象的通知。</p>
<ul>
<li>通过合并我们可以用来保证相同的通知只被发送一次。</li>
</ul>
<ul>
<li><code>forModes:(nullable NSArray&lt;NSRunLoopMode&gt; *)modes</code>可以使用不同的<code>NSRunLoopMode</code>配合来发送通知，可以看出实际上<code>NSNotificationQueue</code>与<code>RunLoop</code>的机制以及运行循环有关系，通过<code>NSNotificationQueue</code>队列来发送的通知和关联的<code>RunLoop</code>运行机制来进行的。</li>
</ul>
<p>八、<strong>NSNotificatinonCenter实现原理</strong></p>
<ul>
<li><code>NSNotificatinonCenter</code>是使用观察者模式来实现的用于跨层传递消息，用来降低耦合度。</li>
</ul>
<ul>
<li><code>NSNotificatinonCenter</code>用来管理通知，将观察者注册到<code>NSNotificatinonCenter</code>的通知调度表中，然后发送通知时利用标识符<code>name</code>和<code>object</code>识别出调度表中的观察者，然后调用相应的观察者的方法，即传递消息（在Objective-C中对象调用方法，就是传递消息，消息有name或者selector，可以接受参数，而且可能有返回值），如果是基于<code>block</code>创建的通知就调用<code>NSNotification</code>的<code>block</code>。</li>
</ul>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>imlifengfeng</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2017/01/27/509/">https://imlifengfeng.github.io/2017/01/27/509/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>原创文章，转载请注明来源</li></ul></div><br><div class="tags"><a href="/tags/iOS/">iOS</a><a href="/tags/通知/">通知</a></div><div class="post-nav"><a class="pre" href="/2017/02/05/512/">iOS FMDB详解</a><a class="next" href="/2017/01/24/504/">iOS中图片自适应拉伸</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=0.0.0"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=0.0.0"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=0.0.0"></script><script>var gitalk = new Gitalk({
  clientID: 'c364198c7db8ed6a1011',
  clientSecret: '7613c9d1c4706bdebff2c7adf84efdf98839ec7d',
  repo: 'imlifengfeng.github.io',
  owner: 'imlifengfeng',
  admin: ['imlifengfeng'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://imlifengfeng.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/">教程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/10/03/714/">iOS 的组件化开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/06/692/">iOS逆向工程之fishhook</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/25/677/">iOS逆向工程之插件开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/03/674/">Swift算法实现之归并排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/01/672/">Swift算法实现之快速排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/31/669/">Swift算法实现之翻转二叉树</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/31/661/">Swift算法实现之二叉树</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/28/658/">Swift算法实现之栈和队列</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/27/654/">Swift算法实现之查找第K大的元素</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/23/652/">Swift算法实现之数组中出现次数超过一半的数字</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">李峰峰博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>