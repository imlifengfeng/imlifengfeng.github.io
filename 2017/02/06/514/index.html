<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>iOS Quartz2D详解 | 李峰峰博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">iOS Quartz2D详解</h1><a id="logo" href="/.">李峰峰博客</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">iOS Quartz2D详解</h1><div class="post-meta">Feb 6, 2017<span> | </span><span class="category"><a href="/categories/iOS/">iOS</a></span></div><div class="post-content"><p>一、<strong>概述</strong></p>
<p>Quartz2D的API是纯C语言的，它是一个二维绘图引擎，同时支持iOS和Mac系统。Quartz2D的API来自于Core Graphics框架，数据类型和函数基本都以CG作为前缀。通常，我们可以使用系统提供的控件去完成大部分UI，但是有些UI界面极其复杂、而且比较个性化，用普通的UI控件无法实现，这时可以利用Quartz2D技术将控件内部的结构画出来，类似自定义控件。其实，iOS中大部分控件的内容都是通过Quartz2D画出来的，因此，Quartz2D在iOS开发中很重要的一个价值是：自定义view（自定义UI控件）。</p>
<p>Quartz 2D能完成的工作：</p>
<p>绘制图形 : 线条\三角形\矩形\圆\弧等；</p>
<p>绘制文字；</p>
<p>绘制\生成图片(图像)；</p>
<p>读取\生成PDF；</p>
<p>截图\裁剪图片；</p>
<p>自定义UI控件；</p>
<p>… …</p>
<p>二、<strong>图形上下文（Graphics Context）</strong></p>
<p>图形上下文（Graphics Context）：是一个CGContextRef类型的数据。</p>
<p>图形上下文的作用：</p>
<p>（1）保存绘图信息、绘图状态</p>
<p>（2）决定绘制的输出目标（绘制到什么地方去？）</p>
<p>（输出目标可以是PDF文件、Bitmap或者显示器的窗口上）</p>
<p><img src="/images/2017/02/图片-1.png" alt="图片 1"></p>
<p>相同的一套绘图序列，指定不同的Graphics Context，就可将相同的图像绘制到不同的目标上。</p>
<p>Quartz2D提供了以下几种类型的Graphics Context：</p>
<p>（1）Bitmap Graphics Context</p>
<p>（2）PDF Graphics Context</p>
<p>（3）Window Graphics Context</p>
<p>（4）Layer Graphics Context</p>
<p>（5）Printer Graphics Context</p>
<p><img src="/images/2017/02/1639.png" alt="1639"></p>
<p>将当前的上下文copy一份,保存到栈顶(那个栈叫做”图形上下文栈”)：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextSaveGState</span>(<span class="built_in">CGContextRef</span> c)</span><br></pre></td></tr></table></figure>
<p>将栈顶的上下文出栈,替换掉当前的上下文（清空之前对于上下文设置）：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextRestoreGState</span>(<span class="built_in">CGContextRef</span> c)</span><br></pre></td></tr></table></figure>
<p>三、<strong>使用Quartz2D自定义View</strong></p>
<p>1、Quartz2D自定义view</p>
<p>如何利用Quartz2D自定义view？（自定义UI控件）如何利用Quartz2D绘制东西到view上？</p>
<p>首先，得有图形上下文，因为它能保存绘图信息，并且决定着绘制到什么地方去。</p>
<p>其次，那个图形上下文必须跟view相关联，才能将内容绘制到view上面。</p>
<p><strong>自定义**</strong>view<strong>**的步骤：</strong></p>
<p>（1）新建一个类，继承自UIView</p>
<p>（2）实现- (void)drawRect:(CGRect)rect方法，然后在这个方法中</p>
<p>（a）取得跟当前view相关联的图形上下文</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">CGContextRef ctx</span> = UIGraphicsGetCurrentContext();</span><br></pre></td></tr></table></figure>
<p>（b）绘制相应的图形内容</p>
<p>例如：画1/4圆（扇形）</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CGContextMoveToPoint(ctx, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">CGContextAddLineToPoint(ctx, <span class="number">100</span>, <span class="number">150</span>);</span><br><span class="line"></span><br><span class="line">CGContextAddArc(ctx, <span class="number">100</span>, <span class="number">100</span>, <span class="number">50</span>, -M_PI_2, M_PI, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">CGContextClosePath(ctx);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[[UIColor redColor] set];</span><br></pre></td></tr></table></figure>
<p>（3）利用图形上下文将绘制的所有内容渲染显示到view上面</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextFillPath(<span class="name">ctx</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>注：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//M_PI的含义:π</span></span><br><span class="line"><span class="comment">//M_PI * 2的含义:2π</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//M_PI_2的含义:π/2</span></span><br><span class="line"><span class="comment">//M_PI / 2的含义:π/2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 画的图形路径</span></span><br><span class="line"><span class="comment">//bezierPathWithArcCenter:弧所在的圆心</span></span><br><span class="line"><span class="comment">//radius:圆的半径</span></span><br><span class="line"><span class="comment">//startAngle:开始角度,圆的最右侧为0度</span></span><br><span class="line"><span class="comment">//endAngle:截至角度,向下为正,向上为负.</span></span><br><span class="line"><span class="comment">//clockwise:时针的方向,yes:顺时针 no:逆时针</span></span><br><span class="line">UIBezierPath *path = [UIBezierPath <span class="string">bezierPathWithArcCenter:</span>self.center <span class="string">radius:</span>radius <span class="string">startAngle:</span>startA <span class="string">endAngle:</span>endA <span class="string">clockwise:</span>NO];</span><br></pre></td></tr></table></figure>
<p>完整代码：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  MyView.m</span></span><br><span class="line"><span class="comment">//  Quartz2DTest</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 李峰峰 on 2017/2/6.</span></span><br><span class="line"><span class="comment">//  Copyright © 2017年 李峰峰. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MyView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];<span class="comment">//设置背景为白色，为了便于观察绘制后的效果</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(ctx, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">100</span>, <span class="number">150</span>);</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(ctx, <span class="number">100</span>, <span class="number">100</span>, <span class="number">50</span>, -M_PI_2, M_PI, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">CGContextClosePath</span>(ctx);</span><br><span class="line">    </span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] set];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(ctx);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="/images/2017/02/Snip20170206_1.png" alt="Snip20170206_1"></p>
<p>2、核心方法drawRect:</p>
<ul>
<li>为什么要实现drawRect:方法才能绘图到view上？</li>
</ul>
<pre><code>* 因为在drawRect:方法中才能取得跟view相关联的图形上下文
</code></pre><ul>
<li>drawRect:方法在什么时候被调用？</li>
</ul>
<pre><code>* 当view第一次显示到屏幕上时（被加到UIWindow上显示出来）


* 调用view的setNeedsDisplay或者setNeedsDisplayInRect:时.
</code></pre><ul>
<li>注意4点:</li>
</ul>
<pre><code>* 手动调用drawRect:方法，不会自动创建跟View相关联的上下文。应该
</code></pre><p>调用setNeedsDisplay方法,系统底层会自动调用drawRect，告诉系统重新绘制View.这样，系统底层会自动创建跟View相关联的上下文</p>
<pre><code>* setNeedsDisplay底层会调用drawRect,并不是立马调用的.只是设了一个调用的标志.调用时刻是等下一次屏幕刷新时才去调用drawRect。屏幕每一秒刷新30-60秒次,所以1秒调用drawRect方法大概30-60次,速度非常快哦


* view内部有个layer（图层）属性，drawRect:方法中取得的是一个Layer Graphics Context，因此，绘制的东西其实是绘制到view的layer上去了


* View之所以能显示东西，完全是因为它内部的layer
</code></pre><p>3、Quartz2D绘图的代码步骤</p>
<p><strong>第一步：获得图形上下文：</strong></p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">CGContextRef ctx</span> = UIGraphicsGetCurrentContext();</span><br></pre></td></tr></table></figure>
<p><strong>第二步：拼接路径（下面代码是绘制一条线段）：</strong></p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CGContextMoveToPoint(<span class="name">ctx</span>, <span class="number">10</span>, <span class="number">10</span>)<span class="comment">;</span></span><br><span class="line">CGContextAddLineToPoint(<span class="name">ctx</span>, <span class="number">100</span>, <span class="number">100</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p><strong>第三步：绘制路径：</strong></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">CGContextStrokePath</span>(ctx); <span class="comment">// CGContextFillPath(ctx);</span></span><br></pre></td></tr></table></figure>
<p>四、<strong>Quartz2D重要函数</strong></p>
<p>1、常用拼接路径函数</p>
<p>新建一个起点</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextMoveToPoint</span>(<span class="built_in">CGContextRef</span> c, <span class="built_in">CGFloat</span> x, <span class="built_in">CGFloat</span> y)</span><br></pre></td></tr></table></figure>
<p>添加新的线段到某个点</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextAddLineToPoint</span>(<span class="built_in">CGContextRef</span> c, <span class="built_in">CGFloat</span> x, <span class="built_in">CGFloat</span> y)</span><br></pre></td></tr></table></figure>
<p>添加一个矩形</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextAddRect</span>(<span class="built_in">CGContextRef</span> c, <span class="built_in">CGRect</span> rect)</span><br></pre></td></tr></table></figure>
<p>添加一个椭圆</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextAddEllipseInRect</span>(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect)</span><br></pre></td></tr></table></figure>
<p>添加一个圆弧</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextAddArc</span>(<span class="built_in">CGContextRef</span> c, <span class="built_in">CGFloat</span> x, <span class="built_in">CGFloat</span> y,</span><br><span class="line"></span><br><span class="line"><span class="built_in">CGFloat</span> radius, <span class="built_in">CGFloat</span> startAngle, <span class="built_in">CGFloat</span> endAngle, <span class="keyword">int</span> clockwise)</span><br></pre></td></tr></table></figure>
<p>2、常用绘制路径函数</p>
<p>一般以CGContextDraw、CGContextStroke、CGContextFill开头的函数，都是用来绘制路径的。</p>
<p>Mode参数决定绘制的模式</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextDrawPath</span>(<span class="built_in">CGContextRef</span> c, <span class="built_in">CGPathDrawingMode</span> mode)</span><br></pre></td></tr></table></figure>
<p>绘制空心路径</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextStrokePath</span>(<span class="built_in">CGContextRef</span> c)</span><br></pre></td></tr></table></figure>
<p>绘制实心路径</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextFillPath</span>(<span class="built_in">CGContextRef</span> c)</span><br></pre></td></tr></table></figure>
<p>3、矩阵操作函数</p>
<p>利用矩阵操作，能让绘制到上下文中的所有路径一起发生变化。</p>
<p>缩放：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextScaleCTM</span>(<span class="built_in">CGContextRef</span> c, <span class="built_in">CGFloat</span> sx, <span class="built_in">CGFloat</span> sy)</span><br></pre></td></tr></table></figure>
<p>旋转：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextRotateCTM</span>(<span class="built_in">CGContextRef</span> c, <span class="built_in">CGFloat</span> angle)</span><br></pre></td></tr></table></figure>
<p>平移：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextTranslateCTM</span>(<span class="built_in">CGContextRef</span> c, <span class="built_in">CGFloat</span> tx, <span class="built_in">CGFloat</span> ty)</span><br></pre></td></tr></table></figure>
<p>4、其他常用函数</p>
<p>设置线段宽度</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextSetLineWidth(<span class="name">ctx</span>, <span class="number">10</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>设置线段头尾部的样式</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextSetLineCap(<span class="name">ctx</span>, kCGLineCapRound)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>设置线段转折点的样式</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextSetLineJoin(<span class="name">ctx</span>, kCGLineJoinRound)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>设置颜色</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextSetRGBStrokeColor(ctx, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>五、<strong>Quartz2D的内存管理</strong></p>
<p>关于Quartz2D内存管理，有以下原则：</p>
<p>（1）使用含有“Create”或“Copy”的函数创建的对象，使用完后必须释放，否则将导致内存泄露。</p>
<p>（2）使用不含有“Create”或“Copy”的函数获取的对象，则不需要释放</p>
<p>（3）如果retain了一个对象，不再使用时，需要将其release掉。</p>
<p>（4）可以使用Quartz 2D的函数来指定retain和release一个对象。例如，如果创建了一个CGColorSpace对象，则使用函数CGColorSpaceRetain和CGColorSpaceRelease来retain和release对象。</p>
<p>（5）也可以使用Core Foundation的CFRetain和CFRelease。注意不能传递NULL值给这些函数。</p>
<p>六、<strong>Quartz2D使用案例</strong></p>
<p>1、画矩形、正方形</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//1.获取上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">//2.描述路径</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithRect:<span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    <span class="comment">//3.把路径添加到上下文</span></span><br><span class="line">    <span class="built_in">CGContextAddPath</span>(ctx, path.CGPath);</span><br><span class="line">    </span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] set];<span class="comment">// 路径的颜色</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4.把上下文的内容渲染到View的layer.</span></span><br><span class="line">    <span class="comment">//CGContextStrokePath(ctx);// 描边路径</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(ctx);<span class="comment">// 填充路径</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="/images/2017/02/Snip20170206_3.png" alt="Snip20170206_3"></p>
<p>2、画扇形</p>
<p>除上面“二、使用Quartz2D自定义View”中的方法外，也可以使用OC中自带画图方法实现，如下：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(CGRect)<span class="built_in">rect</span> &#123;</span><br><span class="line">    </span><br><span class="line">    CGPoint center = CGPointMake(<span class="built_in">rect</span>.<span class="built_in">size</span>.<span class="built_in">width</span> * <span class="number">0.5</span>, <span class="built_in">rect</span>.<span class="built_in">size</span>.<span class="built_in">height</span> * <span class="number">0.5</span>);</span><br><span class="line">    CGFloat radius = <span class="built_in">rect</span>.<span class="built_in">size</span>.<span class="built_in">width</span> * <span class="number">0.5</span> - <span class="number">10</span>;</span><br><span class="line">    CGFloat startA = <span class="number">0</span>;</span><br><span class="line">    CGFloat endA = -M_PI_2;</span><br><span class="line">    <span class="comment">// 画弧的路径</span></span><br><span class="line">    UIBezierPath *path = [UIBezierPath bezierPathWithArcCenter:center radius:radius startAngle:startA endAngle:endA clockwise:NO];</span><br><span class="line">    <span class="comment">// 添加一根线到圆心</span></span><br><span class="line">    [path addLineToPoint:center];</span><br><span class="line">    <span class="comment">// 闭合路径</span></span><br><span class="line">    [path closePath];</span><br><span class="line">    <span class="comment">// 路径颜色</span></span><br><span class="line">    [[UIColor redColor] <span class="built_in">set</span>];</span><br><span class="line">    <span class="comment">// 填充路径</span></span><br><span class="line">    [path <span class="built_in">fill</span>];</span><br><span class="line">    <span class="comment">// 描边路径</span></span><br><span class="line">    <span class="comment">//[path stroke];</span></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="/images/2017/02/Snip20170206_4.png" alt="Snip20170206_4"></p>
<p>注：</p>
<p>判断一个点是否在一个矩形框内</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGRectContainsPoint（<span class="built_in">rect</span>,<span class="built_in">point</span>）;<span class="comment">//判断point这个点是否在rect这个矩形框内</span></span><br></pre></td></tr></table></figure>
<p>3、画圆形</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//1.获取上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">//2.描述路径</span></span><br><span class="line">    <span class="comment">// cornerRadius:圆角半径。矩形的宽高都为200，如果圆角为100，那么两个角之间弧线上任意一点到矩形中心的距离都为100,所以为圆形</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithRoundedRect:<span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">200</span>) cornerRadius:<span class="number">100</span>];</span><br><span class="line">    <span class="comment">//3.把路径添加到上下文</span></span><br><span class="line">    <span class="built_in">CGContextAddPath</span>(ctx, path.CGPath);</span><br><span class="line">    </span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] set];<span class="comment">// 路径的颜色</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4.把上下文的内容渲染到View的layer.</span></span><br><span class="line">    <span class="comment">// CGContextStrokePath(ctx);// 描边路径</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(ctx);<span class="comment">// 填充路径</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="/images/2017/02/Snip20170206_5.png" alt="Snip20170206_5"></p>
<p>4、画圆角矩形</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//1.获取上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">//2.描述路径</span></span><br><span class="line">    <span class="comment">// cornerRadius:圆角半径。</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithRoundedRect:<span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">200</span>) cornerRadius:<span class="number">50</span>];</span><br><span class="line">    <span class="comment">//3.把路径添加到上下文</span></span><br><span class="line">    <span class="built_in">CGContextAddPath</span>(ctx, path.CGPath);</span><br><span class="line">    </span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] set];<span class="comment">// 路径的颜色</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4.把上下文的内容渲染到View的layer.</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(ctx);<span class="comment">// 描边路径</span></span><br><span class="line">    <span class="comment">//CGContextFillPath(ctx);// 填充路径</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="/images/2017/02/Snip20170206_6.png" alt="Snip20170206_6"></p>
<p>5、画直线</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//1.获取跟View相关联的上下文(uigraphics开头)</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2.描述路径</span></span><br><span class="line">    <span class="comment">//一条路径可以绘制多条线 路径:path     路径绘制多条线:path使用了两次（2次的起点到终点），都是将线添加到某个点</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPath];</span><br><span class="line">    <span class="comment">//设置起点</span></span><br><span class="line">    [path moveToPoint:<span class="built_in">CGPointMake</span>(<span class="number">50</span>, <span class="number">150</span>)];</span><br><span class="line">    <span class="comment">//添加一根线Line到某个点</span></span><br><span class="line">    [path addLineToPoint:<span class="built_in">CGPointMake</span>(<span class="number">250</span>, <span class="number">50</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//画第二根线</span></span><br><span class="line">    [path moveToPoint:<span class="built_in">CGPointMake</span>(<span class="number">50</span>, <span class="number">250</span>)];</span><br><span class="line">    [path addLineToPoint:<span class="built_in">CGPointMake</span>(<span class="number">250</span>, <span class="number">100</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置线宽</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">20</span>);</span><br><span class="line">    <span class="comment">//设置线的连接样式</span></span><br><span class="line">    <span class="built_in">CGContextSetLineJoin</span>(ctx, kCGLineJoinBevel);</span><br><span class="line">    <span class="comment">//设置线的顶角样式</span></span><br><span class="line">    <span class="built_in">CGContextSetLineCap</span>(ctx, kCGLineCapRound);<span class="comment">// 圆角线条</span></span><br><span class="line">    <span class="comment">//设置线条颜色</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] set];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//3.把路径添加到上下文</span></span><br><span class="line">    <span class="built_in">CGContextAddPath</span>(ctx, path.CGPath);</span><br><span class="line">    <span class="comment">//4.把上下文当中绘制的内容渲染到跟View关联的layer</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="/images/2017/02/Snip20170206_7.png" alt="Snip20170206_7"></p>
<p>6、画曲线</p>
<p>本塞尔曲线原理：</p>
<p><img src="/images/2017/02/2364940-93c60e25992fecb7.gif" alt="2364940-93c60e25992fecb7"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//1.获取跟View相关联的上下文.】</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">//2.描述路径</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span>  bezierPath];</span><br><span class="line">    <span class="comment">//画曲线,设置起点.还有一个控制点(用来控制曲线的方向跟弯曲程度)</span></span><br><span class="line">    <span class="comment">//设置起点</span></span><br><span class="line">    [path moveToPoint:<span class="built_in">CGPointMake</span>(<span class="number">10</span>, <span class="number">150</span>)];</span><br><span class="line">    <span class="comment">//添加一要曲线到某个点</span></span><br><span class="line">    [path addQuadCurveToPoint:<span class="built_in">CGPointMake</span>(<span class="number">200</span>, <span class="number">150</span>) controlPoint:<span class="built_in">CGPointMake</span>(<span class="number">150</span>, <span class="number">10</span>)];</span><br><span class="line">    <span class="comment">//3.把路径添加到上下文当中</span></span><br><span class="line">    <span class="built_in">CGContextAddPath</span>(ctx, path.CGPath);</span><br><span class="line">    <span class="comment">//4.把上下文的内容渲染View上</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="/images/2017/02/Snip20170206_8.png" alt="Snip20170206_8"></p>
<p>7、画饼图</p>
<p>方法1：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSArray</span> *dataArray =  @[@<span class="number">25</span>,@<span class="number">25</span>,@<span class="number">50</span>];</span><br><span class="line">    <span class="comment">// 画弧</span></span><br><span class="line">    <span class="built_in">CGPoint</span> center = <span class="built_in">CGPointMake</span>(rect.size.width * <span class="number">0.5</span>, rect.size.height * <span class="number">0.5</span>);</span><br><span class="line">    <span class="comment">// 半径</span></span><br><span class="line">    <span class="built_in">CGFloat</span> radius = rect.size.width * <span class="number">0.5</span> - <span class="number">10</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGFloat</span> startA = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> angle = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> endA = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSNumber</span> *num <span class="keyword">in</span> dataArray) &#123;</span><br><span class="line">        startA = endA;</span><br><span class="line">        <span class="comment">// 遍历出第一个对象25,angle =25/100 *2π，即angle = π/2，所以为1/4圆,</span></span><br><span class="line">        angle = num.intValue / <span class="number">100.0</span> * M_PI * <span class="number">2</span>;</span><br><span class="line">        <span class="comment">// 截至角度= 开始的角度+ 遍历出的对象所占整个圆形的角度</span></span><br><span class="line">        endA = startA + angle;</span><br><span class="line">        <span class="comment">// 顺势针画贝塞尔曲线</span></span><br><span class="line">        <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithArcCenter:center radius:radius startAngle:startA endAngle:endA clockwise:<span class="literal">YES</span>];</span><br><span class="line">        <span class="comment">// 设置随机颜色</span></span><br><span class="line">        [[<span class="keyword">self</span> randomColor] set];</span><br><span class="line">        <span class="comment">// 添加一根线到圆心</span></span><br><span class="line">        [path addLineToPoint:center];</span><br><span class="line">        <span class="comment">// 填充路径</span></span><br><span class="line">        [path fill];</span><br><span class="line">        <span class="comment">// 描边路径</span></span><br><span class="line"><span class="comment">//      [path stroke];</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 生成随机颜色</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> @return UIColor</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">-(<span class="built_in">UIColor</span> *)randomColor&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGFloat</span> redLevel    = rand() / (<span class="keyword">float</span>) RAND_MAX;</span><br><span class="line">    <span class="built_in">CGFloat</span> greenLevel  = rand() / (<span class="keyword">float</span>) RAND_MAX;</span><br><span class="line">    <span class="built_in">CGFloat</span> blueLevel   = rand() / (<span class="keyword">float</span>) RAND_MAX;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">UIColor</span> colorWithRed: redLevel green: greenLevel blue: blueLevel alpha: <span class="number">1.0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="/images/2017/02/Snip20170206_9.png" alt="Snip20170206_9"></p>
<p>方法二：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGPoint</span> center = <span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.bounds.size.width * <span class="number">0.5</span>, <span class="keyword">self</span>.bounds.size.height * <span class="number">.5</span>);</span><br><span class="line">    <span class="built_in">CGFloat</span> radius = <span class="keyword">self</span>.bounds.size.width * <span class="number">0.5</span> - <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> startA = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> endA = <span class="number">25</span> / <span class="number">100.0</span> * M_PI * <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithArcCenter:center radius:radius startAngle:startA endAngle:endA clockwise:<span class="literal">YES</span>];</span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] set];</span><br><span class="line">    <span class="comment">//添加一根线到圆心</span></span><br><span class="line">    [path addLineToPoint:center];</span><br><span class="line">    [path fill];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//第二个扇形</span></span><br><span class="line">    startA = endA;</span><br><span class="line">    <span class="built_in">CGFloat</span> angle = <span class="number">25</span> / <span class="number">100.0</span> * M_PI * <span class="number">2</span>;</span><br><span class="line">    endA = startA + angle;</span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path2 = [<span class="built_in">UIBezierPath</span> bezierPathWithArcCenter:center radius:radius startAngle:startA endAngle:endA clockwise:<span class="literal">YES</span>];</span><br><span class="line">    [[<span class="built_in">UIColor</span> greenColor] set];</span><br><span class="line">    <span class="comment">//添加一根线到圆心</span></span><br><span class="line">    [path2 addLineToPoint:center];</span><br><span class="line">    [path2 fill];</span><br><span class="line">    </span><br><span class="line">    startA = endA;</span><br><span class="line">    angle = <span class="number">50</span> / <span class="number">100.0</span> * M_PI * <span class="number">2</span>;</span><br><span class="line">    endA = startA + angle;</span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path3 = [<span class="built_in">UIBezierPath</span> bezierPathWithArcCenter:center radius:radius startAngle:startA endAngle:endA clockwise:<span class="literal">YES</span>];</span><br><span class="line">    [[<span class="built_in">UIColor</span> blueColor] set];</span><br><span class="line">    <span class="comment">//添加一根线到圆心</span></span><br><span class="line">    [path3 addLineToPoint:center];</span><br><span class="line">    [path3 fill];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 生成随机颜色</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> @return UIColor</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">-(<span class="built_in">UIColor</span> *)randomColor&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGFloat</span> redLevel    = rand() / (<span class="keyword">float</span>) RAND_MAX;</span><br><span class="line">    <span class="built_in">CGFloat</span> greenLevel  = rand() / (<span class="keyword">float</span>) RAND_MAX;</span><br><span class="line">    <span class="built_in">CGFloat</span> blueLevel   = rand() / (<span class="keyword">float</span>) RAND_MAX;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">UIColor</span> colorWithRed: redLevel green: greenLevel blue: blueLevel alpha: <span class="number">1.0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：</p>
<p>如果想实现点击以下变换颜色可以加上如下代码：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重绘</span></span><br><span class="line">    [<span class="keyword">self</span> setNeedsDisplay];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8、绘制文字</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"李峰峰博客：http://www.imlifengfeng.com/"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *dict = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    <span class="comment">//设置字体</span></span><br><span class="line">    dict[<span class="built_in">NSFontAttributeName</span>] = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">30</span>];</span><br><span class="line">    <span class="comment">//设置颜色</span></span><br><span class="line">    dict[<span class="built_in">NSForegroundColorAttributeName</span>] = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="comment">//设置描边</span></span><br><span class="line">    dict[<span class="built_in">NSStrokeColorAttributeName</span>] = [<span class="built_in">UIColor</span> blueColor];</span><br><span class="line">    dict[<span class="built_in">NSStrokeWidthAttributeName</span>] = @<span class="number">3</span>;</span><br><span class="line">    <span class="comment">//设置阴影</span></span><br><span class="line">    <span class="built_in">NSShadow</span> *shadow = [[<span class="built_in">NSShadow</span> alloc] init];</span><br><span class="line">    shadow.shadowColor = [<span class="built_in">UIColor</span> greenColor];</span><br><span class="line">    shadow.shadowOffset = <span class="built_in">CGSizeMake</span>(<span class="number">-2</span>, <span class="number">-2</span>);</span><br><span class="line">    shadow.shadowBlurRadius = <span class="number">3</span>;</span><br><span class="line">    dict[<span class="built_in">NSShadowAttributeName</span>] = shadow;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置文字的属性</span></span><br><span class="line">    <span class="comment">//drawAtPoint不会自动换行</span></span><br><span class="line">    <span class="comment">//[str drawAtPoint:CGPointMake(0, 0) withAttributes:dict];</span></span><br><span class="line">    <span class="comment">//drawInRect会自动换行</span></span><br><span class="line">    [str drawInRect:<span class="keyword">self</span>.bounds withAttributes:dict];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="/images/2017/02/Snip20170206_10.png" alt="Snip20170206_10"></p>
<p>9、加水印</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ViewController.m</span></span><br><span class="line"><span class="comment">//  Quartz2DTest</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 李峰峰 on 2017/2/6.</span></span><br><span class="line"><span class="comment">//  Copyright © 2017年 李峰峰. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MyView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIImageView</span> *myImageView = [[<span class="built_in">UIImageView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, [<span class="built_in">UIScreen</span> mainScreen].bounds.size.width, [<span class="built_in">UIScreen</span> mainScreen].bounds.size.height)];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:myImageView];</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//生成一张图片</span></span><br><span class="line">    <span class="comment">//0.加载图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *oriImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"test"</span>];</span><br><span class="line">    <span class="comment">//1.创建位图上下文(size:开启多大的上下文,就会生成多大的图片)</span></span><br><span class="line">    <span class="built_in">UIGraphicsBeginImageContext</span>(oriImage.size);</span><br><span class="line">    <span class="comment">//2.把图片绘制到上下文当中</span></span><br><span class="line">    [oriImage drawAtPoint:<span class="built_in">CGPointZero</span>];</span><br><span class="line">    <span class="comment">//3.绘制水印(虽说UILabel可以快速实现这种效果，但是我们也可以绘制出来)</span></span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"李峰峰博客"</span>;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *dict = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    dict[<span class="built_in">NSFontAttributeName</span>] = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">20</span>];</span><br><span class="line">    dict[<span class="built_in">NSForegroundColorAttributeName</span>] = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    </span><br><span class="line">    [str drawAtPoint:<span class="built_in">CGPointZero</span> withAttributes:dict];</span><br><span class="line">    <span class="comment">//4.从上下文当中生成一张图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *newImage = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">    <span class="comment">//5.关闭位图上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    myImageView.image = newImage;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="/images/2017/02/Snip20170206_11.png" alt="Snip20170206_11"></p>
<p>10、屏幕截图</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//生成图片</span></span><br><span class="line">    <span class="comment">//1.开启一个位图上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsBeginImageContext</span>(<span class="keyword">self</span>.view.bounds.size);</span><br><span class="line">    <span class="comment">//2.把View的内容绘制到上下文当中</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> ctx =  <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">//UIView内容想要绘制到上下文当中, 必须使用渲染的方式</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer renderInContext:ctx];</span><br><span class="line">    <span class="comment">//3.从上下文当中生成一张图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *newImage = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">    <span class="comment">//4.关闭上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">    <span class="comment">//把图片转成二进制流</span></span><br><span class="line">    <span class="comment">//NSData *data = UIImageJPEGRepresentation(newImage, 1);</span></span><br><span class="line">    <span class="built_in">NSData</span> *data = <span class="built_in">UIImagePNGRepresentation</span>(newImage);</span><br><span class="line">    </span><br><span class="line">    [data writeToFile:<span class="string">@"/Users/lifengfeng/Downloads/imlifengfeng.jpg"</span> atomically:<span class="literal">YES</span>];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p>截图而已，就跟普通截图一样，自己试。</p>
<p>以上就是关于Quartz2D一些常用的案例，Quartz2D还可以实现更多效果，具体的根据需求去实现。</p>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>imlifengfeng</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2017/02/06/514/">http://www.imlifengfeng.com/2017/02/06/514/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>原创文章，转载请注明来源</li></ul></div><br><div class="tags"><a href="/tags/iOS/">iOS</a><a href="/tags/Quartz2D/">Quartz2D</a></div><div class="post-nav"><a class="pre" href="/2017/02/08/528/">iOS UIWebView与WKWebView</a><a class="next" href="/2017/02/05/512/">iOS FMDB详解</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=0.0.0"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=0.0.0"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=0.0.0"></script><script>var gitalk = new Gitalk({
  clientID: 'c364198c7db8ed6a1011',
  clientSecret: '7613c9d1c4706bdebff2c7adf84efdf98839ec7d',
  repo: 'imlifengfeng.github.io',
  owner: 'imlifengfeng',
  admin: ['imlifengfeng'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://www.imlifengfeng.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/">教程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/10/03/714/">iOS 的组件化开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/06/692/">iOS逆向工程之fishhook</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/25/677/">iOS逆向工程之插件开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/03/674/">Swift算法实现之归并排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/01/672/">Swift算法实现之快速排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/31/669/">Swift算法实现之翻转二叉树</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/31/661/">Swift算法实现之二叉树</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/28/658/">Swift算法实现之栈和队列</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/27/654/">Swift算法实现之查找第K大的元素</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/23/652/">Swift算法实现之数组中出现次数超过一半的数字</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">李峰峰博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>